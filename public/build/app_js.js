(()=>{const e=localStorage.getItem("theme"),t=()=>e||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");function n(e){"auto"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.setAttribute("data-bs-theme","dark"):document.documentElement.setAttribute("data-bs-theme",e)}n(t()),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(()=>{"light"===e&&"dark"===e||n(t())})),document.querySelectorAll("[data-bs-theme-value]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const o=e.getAttribute("data-bs-theme-value");localStorage.setItem("theme",o),n(o)}))}));var o=new Array;function a(e){return"undefined"!==o[e]&&!0===o[e]}function r(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function i(e){switch(e){case"setBadge":"setAppBadge"in navigator?navigator.setAppBadge(r(1,99)).catch((function(e){u(e),console.log(e)})):"setExperimentalAppBadge"in navigator&&navigator.setExperimentalAppBadge(r(1,99)).catch((function(e){u(e),console.log(e)}));break;case"clearBadge":navigator.clearAppBadge&&navigator.clearAppBadge().catch((function(e){u(e),console.log(e)}));break;case"bluetooth":navigator.bluetooth.requestDevice({acceptAllDevices:!0}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}));break;case"getCameras":if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var t={video:{facingMode:"environment"}};navigator.mediaDevices.getUserMedia(t).then((function(e){navigator.mediaDevices.enumerateDevices().then((function(e){console.log(e);var t=document.getElementById("selectCamera");t.parentNode.classList.remove("d-none"),t.innerHTML="";for(var n=0;n!==e.length;++n){var o=e[n];"videoinput"===o.kind&&o.label&&(u(o.label),t.innerHTML+='<option value="'+o.deviceId+'">'+o.label+"</option>")}d("detect-mediastreamapi"),"ImageCapture"in window&&d("detect-imagecaptureapi")})).catch((function(e){console.log(e)}))}))}break;case"getStream":navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(v({title:"in progress"}),t=""!==document.getElementById("selectCamera").value?{video:{facingMode:"environment",deviceId:{exact:document.getElementById("selectCamera").value}}}:{video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(t).then((function(e){console.log(e);var t=document.getElementById("video");if(t.parentNode.classList.remove("d-none"),t.srcObject=e,"ImageCapture"in window){console.log(e.getVideoTracks()),console.log(e.getVideoTracks()[0].getSettings());var n=e.getVideoTracks()[0];imageCapture=new ImageCapture(n)}})).catch((function(e){console.log(e),"NotFoundError"==e.name&&v({title:"Not found"}),"DevicesNotFoundError"==e.name&&v({title:"Device not found"}),"PermissionDeniedError"==e.name&&v({title:"Permission denied"})})));break;case"takePhoto":imageCapture&&(imageCapture.getPhotoCapabilities().then((function(e){return console.log(e),imageCapture.getPhotoSettings()})).then((function(e){console.log(e)})).catch((function(e){console.log(e)})),imageCapture.takePhoto().then((function(e){console.log(e);var t=document.getElementById("image");t.parentNode.classList.remove("d-none"),t.src=URL.createObjectURL(e)})).catch((function(e){console.log(e)})));break;case"serviceWorkerRegister":a("serviceworker")&&navigator.serviceWorker.register("serviceworker.js").then((function(e){console.log(e),v({title:"Service Worker",body:"register"}),p({command:"cache-key"}),d("detect-serviceworker"),"pushManager"in e&&(d("detect-pushapi"),e.pushManager.getSubscription().then((function(e){e&&"object"==typeof e&&console.log(e),console.log(PushManager.supportedContentEncodings)})).catch((function(e){console.log(e)}))),e.addEventListener("updatefound",(function(e){console.log(e),p({command:"reload-cache"})})),e.installing?u("register installing"):e.waiting?u("register waiting"):e.active&&u("register active")})).catch((function(e){console.log(e)}));break;case"serviceWorkerUnregister":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){v({title:"Service Worker",body:"unregister"})}))}));break;case"pushManagerSubscribe":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){"pushManager"in e&&e.pushManager.permissionState({userVisibleOnly:!0}).then((function(t){u("permissionState: "+t),v({title:"Push API",body:t}),"prompt"!=t&&"granted"!=t||e.pushManager.subscribe({applicationServerKey:l("BOL1MjOgSneIArw6ZdxxL1UqSdnDnsxGT8WaNqBVgwtSPSHJdlY3tLffFwLzPiuUWr_87KyxLKcUsAImyBKTusU"),userVisibleOnly:!0}).then((function(e){if(console.log(e),e&&"object"==typeof e){v({title:"Push API",body:"done"});var t=e.toJSON();u("endpoint: "+e.endpoint),u("public_key: "+t.keys.p256dh),u("authentication_secret: "+t.keys.auth)}})).catch((function(e){console.log(e)}))}))}));break;case"pushManagerUnsubscribe":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){"pushManager"in e&&e.pushManager.getSubscription().then((function(e){console.log(e),e&&"object"==typeof e&&e.unsubscribe().then((function(){v({title:"Push API",body:"done"})}))}))}));break;case"pushManagerPermissionState":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){"pushManager"in e&&e.pushManager.permissionState({userVisibleOnly:!0}).then((function(e){u("permissionState: "+e),v({title:"Push API",body:e})}))}));break;case"serviceWorkerUpdate":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){e.update().then((function(){u("update done")}))}));break;case"serviceWorkerSyncRegister":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){"sync"in e?e.sync.register("playground-pwa-sync").then():v({title:"Service Worker",body:"sync not supported"})}));break;case"serviceWorkerPeriodSyncRegister":a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){"periodicSync"in e?e.periodicSync.register({tag:"playground-pwa-periodicSync",minPeriod:432e5,powerState:"avoid-draining",networkState:"avoid-cellular"}).then():v({title:"Service Worker",body:"periodic sync not supported"})}));break;case"share":"share"in navigator&&navigator.share({title:document.title,text:"Hello World",url:window.location.href}).then((function(){u("share")}));break;case"geolocationGet":"geolocation"in navigator&&(v({title:"Geolocation API",body:"in progress"}),navigator.geolocation.getCurrentPosition((function(e){console.log(e),u(e.coords.latitude+","+e.coords.longitude),v({title:"Geolocation API",body:e.coords.latitude+","+e.coords.longitude})}),(function(e){console.log(e),u(e.message),v({title:"Geolocation API",body:e.message})}),{enableHighAccuracy:!0,timeout:1e4}));break;case"geolocationState":"permissions"in navigator?navigator.permissions.query({name:"geolocation"}).then((function(e){v({title:"Geolocation API",body:e.state})})):v({title:"Permissions API not supported"});break;case"cameraState":"permissions"in navigator?navigator.permissions.query({name:"camera"}).then((function(e){v({title:e.state})})):v({title:"Permissions API not supported"});break;case"screenOrientation":g("buttonOrientation"),"screen"in window&&"orientation"in screen&&(document.getElementById("buttonOrientation").textContent=window.screen.orientation.type,d("buttonOrientation"));break;case"updateOnlineStatus":navigator.onLine?(g("buttonOffline"),d("buttonOnline")):(g("buttonOnline"),d("buttonOffline"));break;case"networkInformation":g("buttonNetwork"),"connection"in navigator&&(void 0!==navigator.connection.type?(document.getElementById("buttonNetwork").textContent=navigator.connection.type,d("buttonNetwork")):void 0!==navigator.connection.effectiveType&&(document.getElementById("buttonNetwork").textContent=navigator.connection.effectiveType,d("buttonNetwork")));break;case"pushEvent":"Notification"in window&&a("serviceworker")&&navigator.serviceWorker.ready.then((function(e){e.pushManager.getSubscription().then((function(e){if(e&&"object"==typeof e){var t=e.toJSON(),n={endpoint:e.endpoint,public_key:t.keys.p256dh,authentication_secret:t.keys.auth,content_encoding:(PushManager.supportedContentEncodings||["aesgcm"])[0]};fetch("notification.php",{method:"POST",body:JSON.stringify(n),headers:new Headers({"Content-Type":"application/json"})}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}})).catch((function(e){console.log(e)}))}))}}function c(){var e=new Date;return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+" "+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds());function t(e){return e<10&&(e="0"+e),e}}function s(e,t){if(0==e)return"0 B";var n=t||2,o=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,o)).toFixed(n))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][o]}function l(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),o=new Uint8Array(n.length);for(var a=0;a<n.length;++a)o[a]=n.charCodeAt(a);return o}function d(e){console.log("show: "+e),document.getElementById(e).classList.remove("d-none")}function g(e){document.getElementById(e).classList.add("d-none")}function u(e){var t=document.getElementById("history"),n=document.createElement("li"),o=document.createTextNode(e);n.appendChild(o),t.insertBefore(n,t.firstChild)}function v(e){void 0!==e.body?document.querySelector(".navbar-brand").innerText=e.title+": "+e.body:document.querySelector(".navbar-brand").innerText=e.title}function p(e){a("serviceworker")&&navigator.serviceWorker.ready.then((function(){return new Promise((function(t,n){var o=new MessageChannel;o.port1.onmessage=function(e){e.data.error?n(e.data.error):t(e.data)},navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage(e,[o.port2])}))}))}u(Intl.DateTimeFormat().resolvedOptions().timeZone),function(){if("storage"in navigator&&("persist"in navigator.storage&&navigator.storage.persist().then((function(e){u(e?"Storage will not be cleared except by explicit user action":"Storage may be cleared by the UA under storage pressure")})),"estimate"in navigator.storage&&navigator.storage.estimate().then((function(e){console.log(e);var t=(e.usage/e.quota*100).toFixed(2);if(u("Quota: "+s(e.quota)),u("Usage: "+s(e.usage)+" ("+t+"%)"),document.getElementById("buttonUsage").textContent=s(e.usage),d("buttonUsage"),void 0!==e.usageDetails)for(const n in e.usageDetails)t=(e.usageDetails[n]/e.usage*100).toFixed(2),u(n+": "+s(e.usageDetails[n])+" ("+t+"%)")}))),"localStorage"in window&&(localStorage.setItem("playground_local_storage","localStorage available"),u(localStorage.getItem("playground_local_storage"))),"sessionStorage"in window&&(sessionStorage.setItem("playground_session_storage","sessionStorage available"),u(sessionStorage.getItem("playground_session_storage"))),"indexedDB"in window){var e=window.indexedDB.open("playground",1);console.log(e),e.onupgradeneeded=function(e){console.log(e);var t=e.target.result;if(!t.objectStoreNames.contains("data")){var n=t.createObjectStore("data",{keyPath:"id"});console.log(n),n.createIndex("date_created","date_created",{unique:!1})}},e.onerror=function(e){console.log(e),u(e.target.error)},e.onsuccess=function(e){console.log(e);var t=e.target.result;t.transaction("data","readwrite").objectStore("data").put({id:1,label:"indexedDB available",date_created:c()});var n=t.transaction("data","readonly").objectStore("data").get(1);console.log(n),n.onsuccess=function(e){console.log(e),u(e.target.result.label)}}}"deviceMemory"in navigator&&u(navigator.deviceMemory+" GB device memory"),"getBattery"in navigator&&navigator.getBattery().then((function(e){console.log(e),document.getElementById("buttonBattery").textContent=100*e.level+"%",d("buttonBattery"),e.addEventListener("levelchange",(function(t){console.log(t),document.getElementById("buttonBattery").textContent=100*e.level+"%"}))})),"serviceWorker"in navigator&&"https:"==window.location.protocol&&(o.serviceworker=!0,i("serviceWorkerRegister"),navigator.serviceWorker.addEventListener("message",(function(e){console.log(e),u("message event from client"),"snackbar"==e.data.type&&v({title:e.data.content}),"history"==e.data.type&&u(e.data.content),"reload"==e.data.type&&(v({title:"reload"}),document.location.reload(e.data.content))})),navigator.serviceWorker.addEventListener("controllerchange",(function(e){console.log(e),u("controllerchange event from client")}))),"share"in navigator&&d("detect-webshareapi"),"geolocation"in navigator&&d("detect-geolocationapi"),(navigator.setAppBadge||navigator.setExperimentalAppBadge)&&d("detect-badgingapi"),"screen"in window&&"orientation"in screen&&(console.log(window.screen.orientation),i("screenOrientation"),window.screen.orientation.addEventListener("change",(function(e){console.log(e),i("screenOrientation")}))),"connection"in navigator&&(console.log(navigator.connection),i("networkInformation"),navigator.connection.addEventListener("change",(function(e){console.log(e),i("networkInformation")}))),"bluetooth"in navigator&&d("detect-bluetooth"),window.matchMedia("(display-mode: standalone)").matches?d("buttonStandalone"):g("buttonStandalone")}(),document.querySelectorAll(".is-action").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),i(e.getAttribute("id"))}))})),window.addEventListener("beforeinstallprompt",(function(e){console.log(e),e.preventDefault(),document.getElementById("install").addEventListener("click",(function(t){e.userChoice.then((function(e){console.log(e),v({title:e.outcome})})).catch((function(e){console.log(e)})),e.prompt()})),d("detect-promptinstall")})),window.addEventListener("appinstalled",(function(e){console.log(e)})),window.addEventListener("online",(function(){i("updateOnlineStatus")})),window.addEventListener("offline",(function(){i("updateOnlineStatus")})),document.addEventListener("DOMContentLoaded",(function(){i("updateOnlineStatus")})),document.getElementById("clearHistory").addEventListener("click",(function(e){e.preventDefault(),document.getElementById("history").innerHTML=""})),document.getElementById("reload").addEventListener("click",(function(e){e.preventDefault(),document.location.reload()}))})();